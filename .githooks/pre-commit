#!/bin/sh
. "$(dirname "$0")/_/sloughi.sh"

echo "Running Sloughi pre-commit..."

# Check formatting of staged Rust files
staged_rs_files=$(git diff --cached --name-only --diff-filter=ACM -- '*.rs')
if [ -n "$staged_rs_files" ]; then
    echo "Checking formatting of staged Rust files..."
    echo "$staged_rs_files" | xargs cargo +nightly fmt -- --check
    if [ $? -ne 0 ]; then
        echo "Format check failed. Run 'cargo +nightly fmt' to fix."
        exit 1
    fi
fi

# Check formatting of staged Markdown files
staged_md_files=$(git diff --cached --name-only --diff-filter=ACM -- '*.md')
if [ -n "$staged_md_files" ]; then
    if command -v markdownlint >/dev/null 2>&1; then
        echo "Checking formatting of staged Markdown files..."
        echo "$staged_md_files" | xargs markdownlint
        if [ $? -ne 0 ]; then
            echo "Markdown lint failed. Fix the issues above."
            exit 1
        fi
    fi
fi
